#!/bin/bash

if [[ $# -lt 1 ]]; then
  echo "usage: $0 <filename> [nocopy]";
  exit 1;
fi

if [[ "$2" = "nocopy" ]]; then
  cat $1 | \
      perl -pe 's#</?text.*?># #g' | \
      perl -pe 's/&amp;/&/g' | \
      perl -MHTML::Entities -pe 'decode_entities($_);' | \
      perl -pe 's/ >>/ \n\n>>/g'
else
  cat $1 | \
      perl -pe 's#</?text.*?># #g' | \
      perl -pe 's/&amp;/&/g' | \
      perl -MHTML::Entities -pe 'decode_entities($_);' | \
      perl -pe 's/ >>/ \n\n>>/g' |
      xclip -selection clipboard -i
  echo "Output copied to clipboard"
fi

